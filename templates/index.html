<html lang="en-US">
<title id='title'>GraphGithub</title>
<head>
<!-- Plotly.js -->
<link rel="stylesheet" type="text/css" href="static/styles.css">
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
<script>
function runScript(){
        if (cemaphore=false) {
            alert("Server is busy, wait for the end of you request first")
            return false;
        }
        
        cemaphore=false;

        if ($("#user").val()!='' && $("#pass").val()=='') {
            alert("Password is missing. To procede annonimously leave both 'user' and 'password' inputs blank");
            return false;
        }
        if ($("#org").val()=='') {
            alert('Organisation is missing');
            return false;
        }
        if ($("#repo").val()=='') {
            alert('Repository is missing');
            return false;
        }


        $("#message").html('Authentication...');
        $("#JsonFile").hide();
        $("#comm").hide();
        $("#cont").hide();
        $("#met").hide();
        $("#graph1").hide();
        $("#metrics").hide();
        $("#graph2").hide();
        $("#slides").show();
                
        $("#slides").html('<div id="loadcont"><img id="load" src="static/unknown.gif"/></div>');

        var url="http://localhost:5000/log?org="+$("#org").val()+"&pass="+$("#pass").val()+"&repo="+$("#repo").val()+"&user="+$("#user").val();

        $.ajax({
            url: url, 
            success: function(result){
                console.log('success');

                var login_succeded=result.login_succeded;
                var repo_exists=result.repo_exists;
                var message=result.message;
                $("#message").html(message);
            },
            error: function(error,status){
                console.log('error');
                console.log(status);
                $("#slides").html('<img src="static/error.svg"/>');

            },
            complete: function(error,status){
                console.log('complete');
                console.log(status);
            }
        });
        
        $("#title").html($("#repo").val());

        $.ajax({
            url: "http://localhost:5000/getCont", 
            success: function(result){
                console.log('success');

                var layout=result.layout;
                var data=result.data;

                $("#slides").hide();
                $(".Explenations").hide();
                $("#graph1").show();

                Plotly.newPlot('graph1', data, layout);
                $("#cont").show();
            },
            error: function(error,status){
                console.log('error');
                console.log(status);
                $("#slides").html('<img src="static/error.svg"/>');

            },
            complete: function(error,status){
                console.log('complete');
                console.log(status);
            }
        });
        $.ajax({
            url: "http://localhost:5000/getComm", 
            success: function(result){
                console.log('success');

                var layout=result.layout;
                var data=result.data;

                $("#graph1").hide();
                $("#slides").hide();
                $(".Explenations").hide();
                $("#graph2").show();

                Plotly.newPlot('graph2', data, layout);
                $("#comm").show();

                $("#graph2").hide();
                $("#graph1").show();
            },
            error: function(error,status){
                console.log('error');
                console.log(status);

                $("#graph1").hide();
                $("#slides").show();
                $("#slides").html('<img src="static/error.svg"/>');

            },
            complete: function(error,status){
                console.log('complete');
                console.log(status);
            }
        });
        $.ajax({
            url: "http://localhost:5000/getAll",
            success: function(result){
                console.log('success');

                $("#graph1").hide();
                $("#slides").hide();
                $(".Explenations").hide();
                $("#metrics").show();

                $("#metrics").html(result);
                $("#met").show();

                $("#metrics").hide();
                $("#graph1").show();
                $("#JsonFile").show();

            },
            error: function(error,status){
                console.log('error');
                console.log(status);

                $("#graph1").hide();
                $("#slides").show();
                $("#slides").html('<img src="static/error.svg"/>');

            },
            complete: function(error,status){
                console.log('complete');
                console.log(status);
            }
        });
        url="";
        cemaphore=true;
};
$(document).ready(function(){
    $(document).keypress(function (){
        if (e.which == 13) {
            runScript();
        }
    });
    $("#submit").click(function(){
        runScript();
    });
    $("#cont").click(function(){
    	$("#slides").hide();
    	$("#graph2").hide();
    	$("#metrics").hide();
    	$("#graph1").show();
    });
    $("#comm").click(function(){
    	$("#slides").hide();
    	$("#graph1").hide();
    	$("#metrics").hide();
    	$("#graph2").show();
    });
    $("#met").click(function(){
    	$("#slides").hide();
    	$("#graph2").hide();
    	$("#graph1").hide();
    	$("#metrics").show();
    });
});
</script>
</head>
<body>
<h1><a href="index.html">GraphGithub</a></h1>
<div id=form>
    <input id="user" type="text" name="user" value="AlexFabre" required>
    <input id="pass" type="password" name="pass" value="Srp043k1" required>
    <input id="org" type="text" name="org" value="twbs" required>
    <input id="repo" type="text" name="repo" value="bootstrap-blog" required>
    <button id="submit">Go</button>
</div>
<div id=message>Github API limits annonimous requests. Connect with your Github logins to disable limitation.</div>
<div id="container">
	<div id="slides"><img src="static/dessin.svg"/></div>
    <div id="graph1"><div class="Explenations"><h2>About contribution</h2><br>Contribution are measured regarding each commit of every file. We use PyGithub3 API and native command line Github API.</div></div>
    <div id="graph2"><div class="Explenations"><h2>About comments</h2><br>Comments are extracted regarding each participant of every issue ('open' for the moment, 'close' issues might follow). We use PyGithub3 API.</div></div>
    <div id="metrics"><div class="Explenations"><h2>About metrics</h2></div></div>
    <div id="prompt"><button class="col" id=cont>Contribution</button><button class="col" id=comm>Comments</button><button class="col" id=met>Metrics</button><div id='JsonFile'><button class="col" id=json>Download</button></div></div>
</div>
</body>
</html>

